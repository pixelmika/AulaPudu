<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AulaPudu – Aprende sin fronteras</title>

  <!-- PDF.js -->
  <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
  <script>
    if (window.pdfjsLib) {
      pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.worker.min.js";
    }
  </script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <!-- Estilos -->
  <link rel="stylesheet" href="css/styles.css?v=3">
</head>
<body>
  <main>
    <section id="landing" class="hero" style="display:flex;">
      <img src="assets/pudu-large.png" alt="Pudu illustration" class="pudu-big" onerror="this.style.display='none'">
      <div class="hero-content">
        <p class="eyebrow">PLATAFORMA INTERACTIVA PARA APRENDIZAJE</p>
        <h2 class="headline">Aprende sin fronteras</h2>
        <p class="subhead">Conecta, aprende y enseña en un entorno digital interactivo, sin límites.</p>
        <div class="cta-list">
          <a class="cta cta-green" onclick="app.ui.showPage('presenter-login')">
            <img src="assets/pudu-icon.png" alt="" class="cta-icon" onerror="this.style.display='none'">
            <span>Entrar como presentador</span>
          </a>
          <a class="cta cta-yellow" onclick="app.ui.showPage('spectator-join')">
            <img src="assets/pudu-icon-grad.png" alt="" class="cta-icon" onerror="this.style.display='none'">
            <span>Entrar como espectador</span>
          </a>
          <a class="cta cta-blue" onclick="app.ui.showPage('exam-join')">
            <img src="assets/pudu-icon.png" alt="" class="cta-icon" onerror="this.style.display='none'">
            <span>Realizar Examen</span>
          </a>
        </div>
      </div> 
    </section>
  </main>

  <div id="app" class="app-shell" style="display:none;">
    <header class="site-header">
      <div class="brand">
        <img src="assets/logo.png" alt="AulaPudu logo" class="logo" onerror="this.style.display='none'">
        <h1>AulaPudu</h1>
      </div>
      <nav class="nav">
        <a onclick="app.ui.showPage('landing')">Inicio</a>
        <span class="sep">|</span>
        <a onclick="app.ui.showPage('presenter-login')">Iniciar</a>
        <span class="sep">|</span>
        <a onclick="app.ui.showPage('spectator-join')">Unirse</a>
      </nav>
    </header>

    <!-- PRESENTER LOGIN -->
    <div id="presenter-login" style="display:none;">
      <div class="card auth-form">
        <h2 id="auth-title">Inicio de Presentador</h2>
        <form id="login-form" onsubmit="event.preventDefault(); app.auth.login();">
          <label for="email">Correo electrónico:</label>
          <input type="email" id="email" placeholder="tu@correo.com" required>
          <label for="password">Contraseña:</label>
          <input type="password" id="password" placeholder="••••••••" required>
          <button type="submit">Iniciar Sesión</button>
          <div id="login-error" style="margin-top:10px;color:#c0392b;font-weight:600;"></div>
          <div class="switch-form">
            ¿No tienes una cuenta? <a onclick="app.ui.toggleAuthForm()">Regístrate aquí</a>
          </div>
        </form>
        <form id="register-form" style="display:none;" onsubmit="event.preventDefault(); app.auth.register();">
          <label for="reg-name">Nombre completo:</label>
          <input type="text" id="reg-name" placeholder="Tu nombre" required>
          <label for="reg-email">Correo electrónico:</label>
          <input type="email" id="reg-email" placeholder="tu@correo.com" required>
          <label for="reg-password">Contraseña:</label>
          <input type="password" id="reg-password" placeholder="Mín. 6 caracteres" minlength="6" required>
          <button type="submit">Registrarse</button>
          <div id="register-error" style="margin-top:10px;color:#c0392b;font-weight:600;"></div>
          <div id="register-success" style="margin-top:10px;color:#1e8449;font-weight:700;"></div>
          <div class="switch-form">
            ¿Ya tienes una cuenta? <a onclick="app.ui.toggleAuthForm()">Inicia sesión aquí</a>
          </div>
        </form>
      </div>
    </div>

    <!-- PRESENTER DASHBOARD -->
   <div id="presenter-dashboard" class="presenter-dashboard" style="display:none; margin-top:30px;">
  <div class="sidebar">
  <button class="sidebar-toggle" onclick="app.ui.toggleSidebar()">→</button>
  <div class="sidebar-header">
    <h3 class="sidebar-title">Menú del Presentador</h3>
  </div>
  <div class="sidebar-content">
    <ul>
      <li><a class="active" onclick="app.ui.showPresenterContent('overview')" data-tooltip="Resumen">
        📊 <span class="sidebar-text">Resumen</span>
      </a></li>
      <li><a onclick="app.ui.showPresenterContent('presentations')" data-tooltip="Presentaciones">
        📁 <span class="sidebar-text">Presentaciones</span>
      </a></li>
      <li><a onclick="app.ui.showPresenterContent('live-session')" data-tooltip="Sesión en Vivo">
        🔴 <span class="sidebar-text">Sesión en Vivo</span>
      </a></li>
      <li><a onclick="app.ui.showPresenterContent('questions')" data-tooltip="Preguntas">
        ❓ <span class="sidebar-text">Preguntas</span>
      </a></li>
      <li><a onclick="app.ui.showPresenterContent('exams')" data-tooltip="Exámenes">
        📝 <span class="sidebar-text">Exámenes</span>
      </a></li>
      <li><a onclick="app.ui.showPresenterContent('creator')" data-tooltip="Creador">
        🎨 <span class="sidebar-text">Creador</span>
      </a></li>
      <li><a onclick="app.ui.showPresenterContent('spectator-management')" data-tooltip="Espectadores">
        👥 <span class="sidebar-text">Espectadores</span>
      </a></li>
      <li><a onclick="app.auth.logout()" data-tooltip="Cerrar Sesión">
        🚪 <span class="sidebar-text">Cerrar Sesión</span>
      </a></li>
    </ul>
  </div>
</div>

      
      <div class="main-content">
        <!-- Overview -->
        <div id="presenter-overview-content" style="display:none;">
          <h2>Resumen del Dashboard</h2>

          <!-- Quick Stats -->
          <div class="dashboard-grid quick-stats">
            <div class="stat-card">
              <div class="stat-icon">👥</div>
              <div class="stat-info">
                <h4>Espectadores</h4>
                <p id="overview-spectators-count">0</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">📁</div>
              <div class="stat-info">
                <h4>Presentaciones</h4>
                <p id="overview-presentations-count">0</p>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">📝</div>
              <div class="stat-info">
                <h4>Exámenes</h4>
                <p id="overview-exams-count">0</p>
              </div>
            </div>
          </div>

          <!-- Main Cards -->
          <div class="dashboard-grid main-cards">
            <div class="dashboard-card large">
              <h4>📊 Presentación Actual</h4>
              <p id="current-presentation-text">No hay ninguna presentación activa en este momento.</p>
              <button onclick="app.ui.showPresenterContent('presentations')">Gestionar Presentaciones</button>
            </div>
            <div class="dashboard-card">
              <h4>🔴 Control de Sesión</h4>
              <div class="session-controls">
                <div class="qr-code-section">
                  <p>Escanear para unirse:</p>
                  <img id="qr-code-img" src="" alt="QR Code" style="width:150px;height:150px;border-radius:12px;display:none;">
                  <div class="session-id" id="session-id-display">--</div>
                  <button onclick="app.session.generateNewSession()">Generar Nuevo QR</button>
                </div>
                <div class="session-actions">
                  <p>Finaliza la sesión actual para todos.</p>
                  <button class="red" onclick="app.session.deleteSessionGlobally()">Finalizar Sesión</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Presentations -->
        <div id="presenter-presentations-content" style="display:none;">
          <h2>Mis Presentaciones</h2>
          <div class="content-card">
            <h3>📤 Subir Nueva Presentación</h3>
            <input type="file" id="presentation-upload" accept=".pdf,.ppt,.pptx,.docx">
            <button id="upload-presentation-btn" onclick="app.content.uploadPresentation()">Subir</button>
            <div id="upload-presentation-status"></div>
          </div>
          <div class="content-card">
            <h3>📁 Disponibles</h3>
            <ul id="presentations-list" style="list-style:none;padding:0;"></ul>
          </div>
        </div>

        <!-- Live Session -->
        <div id="presenter-live-session-content" style="display:none;">
          <h2>Control de Sesión en Vivo</h2>
          <div class="presentation-controls">
            <div class="live-reactions">
              <div class="reaction-badge"><span>❤️</span><span class="count" id="count-love">0</span></div>
              <div class="reaction-badge"><span>👏</span><span class="count" id="count-clap">0</span></div>
              <div class="reaction-badge"><span>❓</span><span class="count" id="count-question">0</span></div>
              <div class="reaction-badge"><span>👍</span><span class="count" id="count-thumbsup">0</span></div>
              <div class="reaction-badge"><span>👎</span><span class="count" id="count-thumbsdown">0</span></div>
            </div>
          </div>
          <!-- En Index.html - Añadir en presenter-live-session-content -->
           <div class="content-card">
            <h3>🎬 Contenido Multimedia</h3>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
              <button onclick="app.session.promptForVideo()">📹 Insertar Video</button>
              <button onclick="app.session.openPresentationMode()">🖥️ Modo Presentación</button>
              <button onclick="app.session.resetTimer()">🔄 Reiniciar Timer</button>
            </div>
          </div>
          <!-- AGREGAR ESTA SECCIÓN DEL TIMER -->
           <div class="content-card">
            <h3>⏰ Cronómetro de Presentación</h3>
            <div class="timer-section" style="text-align: center; padding: 20px;">
              <div style="display: flex; gap: 10px; justify-content: center; margin-bottom: 15px; flex-wrap: wrap;"><div>
                <label style="display: block; font-weight: 600; margin-bottom: 5px;">Horas</label>
                <input type="number" id="timer-hours" min="0" max="23" value="0" style="width: 80px; padding: 8px; border: 1px solid #ddd; border-radius: 8px;">
              </div>
              <div>
                <label style="display: block; font-weight: 600; margin-bottom: 5px;">Minutos</label>
                <input type="number" id="timer-minutes" min="0" max="59" value="10" style="width: 80px; padding: 8px; border: 1px solid #ddd; border-radius: 8px;">
              </div>
              <div>
                <label style="display: block; font-weight: 600; margin-bottom: 5px;">Segundos</label>
                <input type="number" id="timer-seconds" min="0" max="59" value="0" style="width: 80px; padding: 8px; border: 1px solid #ddd; border-radius: 8px;">
              </div>
            </div>
            <div id="timer-display" style="font-size: 48px; font-weight: 800; color: #d9534f; margin: 20px 0; font-family: monospace;">
              00:10:00
            </div>
            <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
              <button onclick="app.session.startTimer()">Iniciar</button>
              <button onclick="app.session.resetTimer()">Reiniciar</button>
            </div>
          </div>
        </div>
          <div class="content-card">
            <h3>🔴 Presentando: <span id="current-presentation-title">--</span></h3>
            <p>Diapositiva: <span id="current-slide">1</span>/<span id="total-slides">1</span></p>
            <div style="display:flex;gap:10px;margin-top:10px;">
              <button onclick="app.content.prevSlide()">Anterior</button>
              <button onclick="app.content.nextSlide()">Siguiente</button>
              <button onclick="app.session.endPresentation()">Finalizar</button>
            </div>
            <div id="pdf-viewer-container" style="width:100%;height:500px;margin-top:20px;border:1px solid #ddd;border-radius:8px;overflow:auto;">
              <canvas id="pdf-canvas" style="display:none;margin:0 auto;"></canvas>
              <div id="current-slide-content" style="padding:20px;text-align:center;display:none;">
                <h3>Diapositiva 1</h3>
                <p>Carga una presentación.</p>
              </div>
            </div>
            <div id="interactive-viewer-container" style="width:100%;height:500px;margin-top:20px;border:1px solid #ddd;border-radius:8px;overflow:auto; display:none; position: relative; background: white;">
              <!-- Las diapositivas interactivas se renderizarán aquí -->
            </div>
          </div>
        </div>

        <!-- Questions -->
        <div id="presenter-questions-content" style="display:none;">
          <h2>Sistema de Preguntas</h2>
          <div class="question-builder">
            <h3>❓ Crear Nueva Pregunta</h3>
            <div class="question-type-selector">
              <button class="active" onclick="app.questions.setQuestionType('multiple-choice', event)">Opción Múltiple</button>
              <button onclick="app.questions.setQuestionType('true-false', event)">Verdadero/Falso</button>
              <button onclick="app.questions.setQuestionType('open-ended', event)">Abierta</button>
            </div>
            <input type="text" id="question-title" placeholder="Escribe tu pregunta">
            <div id="options-container" class="options-container">
              <div class="option-input">
                <input type="text" placeholder="Opción 1">
                <button class="red" onclick="app.questions.removeOption(this)">✕</button>
              </div>
              <div class="option-input">
                <input type="text" placeholder="Opción 2">
                <button class="red" onclick="app.questions.removeOption(this)">✕</button>
              </div>
            </div>
            <button class="add-option" onclick="app.questions.addOption()">+ Añadir</button>
            <button class="option-button" onclick="app.questions.saveQuestion()" style="width:100%;margin-top:15px;">💾 Guardar</button>
          </div>
          <div class="content-card">
            <h3>📋 Guardadas</h3>
            <ul id="saved-questions" style="list-style:none;padding:0;"></ul>
          </div>
        </div>

        <!-- Spectator Management -->
        <div id="presenter-spectator-management-content" style="display:none;">
          <h2>Gestión de Espectadores</h2>
          <div class="content-card">
            <h3>👥 Conectados (<span id="active-spectators">0</span>)</h3>
            <ul id="spectators-list" style="list-style:none;padding:0;"></ul>
          </div>
        </div>

        <!-- Exams -->
        <div id="presenter-exams-content" style="display:none;">
          <h2>Módulo de Exámenes</h2>
          <div class="content-card">
            <h3>📝 Mis Exámenes</h3>
            <ul id="exams-list" style="list-style:none;padding:0; margin-bottom: 20px;"><li>No has creado ningún examen todavía.</li></ul>
            <button id="show-exam-creator-btn" onclick="app.ui.toggleExamCreator()">+ Crear Nuevo Examen</button>
          </div>

          <div id="exam-creator-card" class="content-card" style="display:none;">
            <h3 id="exam-creator-title">Crear Nuevo Examen</h3>
            <div class="form-group" style="margin-bottom: 15px;">
              <label for="exam-title">Título del Examen:</label>
              <input type="text" id="exam-title" placeholder="Ej: Examen Parcial de Historia" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div class="form-group" style="margin-bottom: 15px;">
              <label for="exam-time-limit">Límite de Tiempo (minutos):</label>
              <input type="number" id="exam-time-limit" placeholder="Ej: 60" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            
            <h4>Preguntas del Examen</h4>
            <div id="exam-questions-container" style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px;">
              <!-- Las preguntas se añadirán aquí dinámicamente -->
            </div>

            <div class="question-type-selector" style="margin-top: 20px;">
              <span>Añadir Pregunta:</span>
              <button onclick="app.exams.addQuestionToCreator('multiple-choice')">Opción Múltiple</button>
              <button onclick="app.exams.addQuestionToCreator('true-false')">Verdadero/Falso</button>
              <button onclick="app.exams.addQuestionToCreator('open-ended')">Abierta</button>
            </div>

            <div style="margin-top: 20px; display: flex; justify-content: flex-end; gap: 10px;">
                <button class="secondary" onclick="app.ui.toggleExamCreator(true)">Cancelar</button>
                <button onclick="app.exams.collectAndSaveExam()">Guardar Examen</button>
            </div>
          </div>
        </div>

        <!-- Presentation Creator -->
        <div id="presenter-creator-content" style="display:none;">
          <h2>Creador de Presentaciones</h2>
          <p>Próximamente...</p>
        </div>
      </div>
    </div>

    <!-- SPECTATOR JOIN -->
    <div id="spectator-join" style="display:none;">
      <div class="spectator-input-card card">
        <h2>Unirse a una Presentación</h2>
        <label for="session-id-input">ID de Sesión:</label>
        <input type="text" id="session-id-input" placeholder="AULAPUDU-12345">
        <label for="spectator-name">Tu Nombre:</label>
        <input type="text" id="spectator-name" placeholder="Tu nombre">
        <button onclick="app.session.joinSession()">Unirse</button>
      </div>
    </div>

    <!-- SPECTATOR INTERFACE CON SISTEMA DE OCULTACIÓN -->
    <div id="spectator-interface" style="display:none;" class="spectator-interface">
      <div class="spectator-container">
        <!-- HEADER CON BOTÓN DE OCULTAR -->
        <div class="spectator-header">
          <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;">
            <div>
              <h2>Presentación: <span id="spectator-presentation-title">...</span></h2>
              <div class="slide-counter">Diapositiva <span id="spectator-slide-number">--</span> de <span id="spectator-total-slides">--</span></div>
            </div>
            <!-- Botón para ocultar controles -->
            <button 
              id="toggle-spectator-controls" 
              onclick="app.session.toggleSpectatorControls()" 
              title="Ocultar/Mostrar controles">
              👁️ Ocultar Controles
            </button>
          </div>
        </div>

        <!-- ÁREA DE PRESENTACIÓN (NO SE OCULTA) -->
        <div class="spectator-presentation-area">
          <div class="slide-content-wrapper">
            <div id="spectator-current-slide-content" class="spectator-slide-placeholder">
              <h3>Esperando</h3>
              <p>La presentación comenzará pronto...</p>
            </div>
            <canvas id="spectator-pdf-canvas" style="display:none;"></canvas>
            <div id="spectator-non-pdf-content" style="display:none;"></div>
          </div>
        </div>

        <!-- SECCIÓN DE INTERACCIONES (ESTA SE OCULTA) -->
        <div class="spectator-interactions-section">
          <div class="spectator-interactions">
            <button onclick="app.session.sendReaction('love')">❤️</button>
            <button onclick="app.session.sendReaction('clap')">👏</button>
            <button onclick="app.session.sendReaction('question')">❓</button>
            <button onclick="app.session.sendReaction('thumbsup')">👍</button>
            <button onclick="app.session.sendReaction('thumbsdown')">👎</button>
          </div>
          <div class="spectator-cta-grid">
            <button onclick="alert('Próximamente')">Responder</button>
            <button onclick="alert('Próximamente')">Subir Archivo</button>
            <button onclick="app.session.leaveSession()">Salir</button>
          </div>
          <!-- Información de atajos -->
          <p style="text-align:center;color:#666;font-size:14px;margin-top:20px;">
            💡 Presiona <strong>H</strong> para ocultar/mostrar | <strong>F</strong> para pantalla completa
          </p>
        </div>
      </div>
    </div>

    <!-- EXAM JOIN -->
    <div id="exam-join" style="display:none;">
      <div class="spectator-input-card card">
        <h2>Unirse a un Examen</h2>
        <label for="exam-code-input">Código del Examen:</label>
        <input type="text" id="exam-code-input" placeholder="AULAPUDU-12345">
        <label for="student-name-input">Tu Nombre Completo:</label>
        <input type="text" id="student-name-input" placeholder="Tu nombre">
        <button onclick="app.exams.joinExam()">Unirse al Examen</button>
        <div id="exam-join-error" style="margin-top:10px;color:#c0392b;font-weight:600;"></div>
      </div>
    </div>

    <!-- EXAM PLAYER INTERFACE -->
    <div id="exam-player" style="display:none;">
      <!-- El contenido del examen se renderizará aquí dinámicamente -->
    </div>

    <!-- EXAM RESULTS INTERFACE -->
    <div id="exam-results" style="display:none;">
      <!-- Los resultados del examen se renderizarán aquí -->
    </div>

  </div>

  <!-- Modal System -->
  <div id="modal-container" style="display:none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; justify-content: center; align-items: center;">
    <div id="modal-content" style="background: white; padding: 30px; border-radius: 12px; max-width: 800px; width: 90%; max-height: 80vh; overflow-y: auto; position: relative;">
      <button id="modal-close-btn" onclick="app.ui.hideModal()" style="position: absolute; top: 10px; right: 10px; border: none; background: transparent; font-size: 24px; cursor: pointer;">&times;</button>
      <h2 id="modal-title" style="margin-top: 0;"></h2>
      <div id="modal-body"></div>
    </div>
  </div>

  <!-- Scripts en orden correcto -->
  <script src="js/config.js"></script>
  <script src="js/managers/Utils.js"></script>
  <script src="js/managers/AuthManager.js"></script>
  <script src="js/managers/SessionManager.js"></script>
  <script src="js/managers/ContentManager.js"></script>
  <script src="js/managers/QuestionManager.js"></script>
  <script src="js/managers/ExamManager.js"></script>
  <script src="js/managers/ExamPlayer.js"></script>
  <script src="js/managers/ExamResultsViewer.js"></script>
  <script src="js/managers/PresentationCreator.js?v=1"></script>
  <script src="js/managers/UIManager.js?v=2"></script>
  <script src="js/app.js"></script>
</body>
</html>
